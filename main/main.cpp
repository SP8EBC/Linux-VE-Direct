/*
 * main.cpp
 *
 *  Created on: 11.09.2017
 *      Author: mateusz
 */


#include <iostream>
#include <vector>
#include "../serial/serial.h"
#include "../config/ProgramConfig.h"
//#include "../umb/UmbThread.h"
#include "../ve_direct_protocol/parser.h"

using namespace std;

/*
uint8_t a [162] =
{
	0x0d, 0x0a, 0x50, 0x49, 0x44, 0x09, 0x30, 0x78,
	0x41, 0x30, 0x34, 0x32, 0x0d, 0x0a, 0x46, 0x57,
	0x09, 0x31, 0x32, 0x37, 0x0d, 0x0a, 0x53, 0x45,
	0x52, 0x23, 0x09, 0x48, 0x51, 0x31, 0x37, 0x32,
	0x33, 0x42, 0x51, 0x54, 0x50, 0x43, 0x0d, 0x0a,
	0x56, 0x09, 0x31, 0x33, 0x33, 0x38, 0x30, 0x0d,
	0x0a, 0x49, 0x09, 0x31, 0x33, 0x32, 0x30, 0x0d,
	0x0a, 0x56, 0x50, 0x56, 0x09, 0x31, 0x39, 0x35,
	0x35, 0x30, 0x0d, 0x0a, 0x50, 0x50, 0x56, 0x09,
	0x31, 0x38, 0x0d, 0x0a, 0x43, 0x53, 0x09, 0x33,
	0x0d, 0x0a, 0x45, 0x52, 0x52, 0x09, 0x30, 0x0d,
	0x0a, 0x4c, 0x4f, 0x41, 0x44, 0x09, 0x4f, 0x4e,
	0x0d, 0x0a, 0x49, 0x4c, 0x09, 0x30, 0x0d, 0x0a,
	0x48, 0x31, 0x39, 0x09, 0x38, 0x39, 0x0d, 0x0a,
	0x48, 0x32, 0x30, 0x09, 0x32, 0x0d, 0x0a, 0x48,
	0x32, 0x31, 0x09, 0x35, 0x30, 0x0d, 0x0a, 0x48,
	0x32, 0x32, 0x09, 0x30, 0x0d, 0x0a, 0x48, 0x32,
	0x33, 0x09, 0x32, 0x35, 0x0d, 0x0a, 0x48, 0x53,
	0x44, 0x53, 0x09, 0x31, 0x30, 0x35, 0x0d, 0x0a,
	0x43, 0x68, 0x65, 0x63, 0x6b, 0x73, 0x75, 0x6d,
	0x09, 0x1f
};
*/

unsigned char a [164] =
{
	0x00, 0x01, 0x0d, 0x0a, 0x50, 0x49, 0x44, 0x09, 0x30, 0x78,
	0x41, 0x30, 0x34, 0x32, 0x0d, 0x0a, 0x46, 0x57,
	0x09, 0x31, 0x32, 0x37, 0x0d, 0x0a, 0x53, 0x45,
	0x52, 0x23, 0x09, 0x48, 0x51, 0x31, 0x37, 0x32,
	0x33, 0x42, 0x51, 0x54, 0x50, 0x43, 0x0d, 0x0a,
	0x56, 0x09, 0x31, 0x33, 0x35, 0x34, 0x30, 0x0d,
	0x0a, 0x49, 0x09, 0x31, 0x33, 0x32, 0x30, 0x0d,
	0x0a, 0x56, 0x50, 0x56, 0x09, 0x31, 0x39, 0x34,
	0x35, 0x30, 0x0d, 0x0a, 0x50, 0x50, 0x56, 0x09,
	0x31, 0x38, 0x0d, 0x0a, 0x43, 0x53, 0x09, 0x33,
	0x0d, 0x0a, 0x45, 0x52, 0x52, 0x09, 0x30, 0x0d,
	0x0a, 0x4c, 0x4f, 0x41, 0x44, 0x09, 0x4f, 0x4e,
	0x0d, 0x0a, 0x49, 0x4c, 0x09, 0x30, 0x0d, 0x0a,
	0x48, 0x31, 0x39, 0x09, 0x39, 0x30, 0x0d, 0x0a,
	0x48, 0x32, 0x30, 0x09, 0x33, 0x0d, 0x0a, 0x48,
	0x32, 0x31, 0x09, 0x35, 0x30, 0x0d, 0x0a, 0x48,
	0x32, 0x32, 0x09, 0x30, 0x0d, 0x0a, 0x48, 0x32,
	0x33, 0x09, 0x32, 0x35, 0x0d, 0x0a, 0x48, 0x53,
	0x44, 0x53, 0x09, 0x31, 0x30, 0x35, 0x0d, 0x0a,
	0x43, 0x68, 0x65, 0x63, 0x6b, 0x73, 0x75, 0x6d,
	0x09, 0x29
};

int main() {
#ifndef _ONLY_MANUAL_CFG
	ProgramConfig::readConfigFromFile();
#endif

#ifdef _ONLY_MANUAL_CFG
	ProgramConfig::manualConfig();
#endif

	uint16_t ln;
	uint8_t valid = 9;

	std::vector<uint8_t> data;

	serial s;

	ve_direct_raw_struct str;

	unsigned char globalChNumber = 0;
	unsigned char devicesNum = ProgramConfig::getDevicesNumber();

	s.init("/dev/ttyUSB0");

	//s.receive(data, 0xA2, 500);

	//delete t;

	ve_direct_parser_init();
	ve_direct_cut_to_checksum(a, 162, &ln);
	ve_direct_validate_checksum(a, ln, &valid);
	ve_direct_parse_to_raw_struct(a, ln, &str);
	ve_direct_add_to_average(&str);

	return 0;

}


